{% if frontend.darwin_filters %}
    ###################
    # DARWIN FILTERS #
    ###################
    {%- for darwin_filter in frontend.darwin_filters %}
    {%- if darwin_filter.enabled %}

    # FILTER {{ darwin_filter.filter.name|upper }}
    {%- if darwin_filter.filter.name == "dga" %}
    foreach( $.name in $!darwin_hostnames ) do {
        set $!tmp3 = $.name!qname;
        action(type="mmdarwin"
           key="dga"
           socketpath="{{ darwin_filter.socket_path }}"
           response="{{ frontend.darwin_mode }}"
           fields=["!tmp3"]
           socket_max_use="5")
    }

    {%- elif darwin_filter.filter.name == "hostlookup" %}
    foreach( $.name in $!darwin_hostnames ) do {
        set $!tmp3 = $.name!qname;
        action(type="mmdarwin"
           key="hostlookup"
           socketpath="{{ darwin_filter.socket_path }}"
           response="{{ frontend.darwin_mode }}"
           fields=["!tmp3"]
           socket_max_use="5")
    }

    {%- elif darwin_filter.filter.name == "content_inspection" %}
    if $!impcap contains "net_src_ip" then {
        action(type="mmdarwin"
            key="content_inspection"
            socketpath="{{ darwin_filter.socket_path }}"
            response="{{ frontend.darwin_mode }}"
            fields=["!impcap", "!data"]
            socket_max_use="10")
    }

    {%- elif darwin_filter.filter.name == "tanomaly" %}
    action(type="mmdarwin"
            socketpath="{{ darwin_filter.socket_path }}"
            fields=["!darwin_src_ip", "!darwin_dst_ip", "!darwin_dst_port", "!darwin_IP_proto"]
            key="tanomaly"
            response="{{ frontend.darwin_mode }}"
            socket_max_use="5")

    {%- elif darwin_filter.filter.name == "connection" %}
    action(type="mmdarwin"
            socketpath="{{ darwin_filter.socket_path }}"
            fields=["!darwin_src_ip", "!darwin_dst_ip", "!darwin_dst_port", "!darwin_IP_proto"]
            key="connection"
            response="{{ frontend.darwin_mode }}"
            socket_max_use="5")

    {%- endif %}

    {%- if darwin_filter.mmdarwin_enabled %}
    # Custom call
    action(type="mmdarwin"
                socketpath="{{ darwin_filter.socket_path }}"
                fields={{darwin_filter.mmdarwin_parameters_rsyslog_str()}}
                key="{{darwin_filter.filter.name}}"
                response="darwin"
                socket_max_use="5")

    {%- endif %}
    {%- endif %}
    {%- endfor %}

    if $!mmdarwin!darwin_id != "" then {
        # Redis cache
        action(type="omhiredis"
            server="127.0.0.3"
            serverport="6379"
            mode="set"
            key="darwin_redis_key"
            dynakey="on"
            expiration="10"
            template="{{frontend.ruleset}}_redis"
            action.resumeRetryCount="3"
            action.resumeInterval="1")
    }

    ######################
    # DARWIN FILTERS END #
    ######################
{% endif %}